<!doctype html>
<meta name=viewport content="width=device-width, initial-scale=1">
<style>
  html, body {
    margin: 0;
    padding: 0;
  }
  body {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }
</style>

<div id="carousel">
  <img src="./images/chrome.png">
  <img src="./images/search.png">
  <img src="./images/photos.png">
  <img src="./images/youtube.png">
  <img src="./images/gmail.png">
  <img src="./images/maps.png">
</div>
<script src="./scripts/animated_blur.js"></script>
<script>
(function() {
  const m = new Map();;
  let timeout = null;
  function onEnter(event) {
    timeout = setTimeout(_ => {
      timeout = null;
      m.forEach((animation, img) => {
        if(img === event.target) return;
        animation.play(AnimatedBlur.BLUR_MODE.BLUR);
      });
    }, 500);
  }

  function onLeave(event) {
    if (timeout) {
      clearTimeout(timeout);
      timeout = null;
    }
    m.forEach((animation, img) => animation.play(AnimatedBlur.BLUR_MODE.UNBLUR));
  }

  document.querySelectorAll('#carousel > img').forEach((img, idx) => {
    img.onmouseenter = onEnter;
    img.onmouseleave = onLeave;
    const animation = new AnimatedBlur(`img-${idx}`, img, {steps: 5, duration: 200});
    animation.update();
    m.set(img, animation);
  });

  // for (var i = 0; i < carousel.children.length; ++i) {
  //   var img = carousel.children[i];
  //   if (img.classList.contains('clonedElement')) break;
  //   img.classList.add('animated-blur');
  //   imgs.push(img);
  //   var animation = new AnimatedBlur('carousel-' + counter++, img,
  //       {steps: 5, duration: 100});
  //   animations.push(animation);

  //   img.resize = function() {
  //     animations[imgs.indexOf(this)].resize();
  //   };

  //   img.onmouseenter = function() {
  //     animations[imgs.indexOf(this)].play(AnimatedBlur.BLUR_MODE.UNBLUR);
  //   };
  //   img.onmouseleave = function() {
  //     animations[imgs.indexOf(this)].play(AnimatedBlur.BLUR_MODE.BLUR);
  //   };
  // }

  // for (var i = 0; i < animations.length; ++i) {
  //   animations[i].update();
  //   animations[i].play(AnimatedBlur.BLUR_MODE.BLUR);
  // }
})();
</script>
